<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="colorlib.com" />
    <title>Filter Results</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous" />

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns"
        crossorigin="anonymous" />

    <link href="https://fonts.googleapis.com/css?family=Poppins:400,800" rel="stylesheet" />

    <link href="css/footer.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/restaurant.css" />

    <link href="css/home-page.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/filterOutput.css" />
    <link rel="stylesheet" href="css/footer.css" />
    <link rel="stylesheet" href="css/nav.css" />

    <!-- Optional JavaScript -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script src="js/nav.js"></script>
</head>

<body>
    <nav class="header navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand brand" href="index.html"><b>SYRUP</b></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample07"
                aria-controls="navbarsExample07" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarsExample07">
                <ul class="navbar-nav mr-auto"></ul>

                <ul class="nav navbar-nav navbar-right">
                    <li class="nav-item">
                        <a class="nav-link" href="About.html">ABOUT <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="FoodFilter.html">FOOD FILTER</a></li>
                    <li class="nav-item"><a class="nav-link" href="Categories.html">CATEGORIES</a></li>
                    <li class="nav-item"><a href="UserProfilePage.html" class="nav-link">PROFILE</a></li>
                    <li><a class="btn btn-link-3" href="Sign-in.html">LOG IN</a></li>
                    <li><a class="btn btn-link-3" href="Sign-up.html">SIGN UP</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="d-none d-lg-block col-lg-6 div-left"></div>
            <div class="col-sm-12 col-lg-6 div-right"></div>
            <div class="text-block">FOOD RESULTS</div>
        </div>
    </div>

    <br />
    <br />
    <div class="divider-1">
        <div class="line"></div>
    </div>
    <br />
    <br />

    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h4><b>BEST MATCH</b></h4>
                <br />
            </div>
        </div>
    </div>

    <section>
        <div class="row  align-items-center justify-content-center">
            <div class="info-card  col-sm-10 col-md-11 col-lg-5 div-left-info">
                <div class="card">
                    <div class="card-body">
                        <a href="Restaurant.html">
                            <h1 class="card-title" id="restaurant-name">Restaurant Name</h1>
                        </a>
                        <h6 class="mb-2 text-muted" id="rating">
                            Overall Rating
                            <span class="rating"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                    class="fas fa-star-half-alt"></i></span>
                        </h6>
                        <h6 class="mb-2 text-muted ">Description</h6>
                        <p class="card-text" id="description">
                            Lorem ipsum dolor sit amet consectetur, adipisicing elit. Perspiciatis tempore omnis
                            vero, tempora adipisci, ut recusandae enim voluptate aut consequuntur, fugiat repellat
                            tenetur dolorum porro placeat ipsum earum exercitationem asperiores.
                        </p>

                        <p class="location card-subtitle text-muted" id="status">
                            <i class="far fa-clock"></i> &nbsp; Closed Today · Opens Thursday at 4:00 PM
                        </p>

                        <p class="location card-subtitle text-muted" id="address">
                            <i class="fas fa-map-marker-alt"></i>&nbsp; Riverplace, North Woodstock, NH 03262, USA
                        </p>
                        <p class="location card-subtitle text-muted" id="phone">
                            <i class="fas fa-phone"></i>&nbsp; 0333 5952109
                        </p>
                        <p class="location card-subtitle text-muted" id="link">
                            <i class="fab fa-chrome"></i>&nbsp; <a href="www.google.com"> www.restaurant.com</a>
                        </p>
                        <!-- <p class="location card-subtitle text-muted" >
                                <i class="fas fa-directions"></i>&nbsp; Get Directions
                            </p> -->
                        <br />
                        <a href="Menu.html" class="card-link" id="menu-link">
                            <h5 class="mb-2 text-muted ">Check out our Menu</h5>
                        </a>
                        <br />
                    </div>
                </div>
            </div>
            <div class=" col-11 col-md-12 col-lg-5" id="map">
                <!-- <img src="images/map.jpg" class="mx-auto d-block img-fluid" /> -->
            </div>
        </div>
    </section>

    <!-- <br />
        <br />
        <br />
        <div class="divider-1"><div class="line"></div></div>
        <br />
        <br />

        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h4><b>MORE RESULTS</b></h4>
                    <br />
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row marginSetting">
                <div class="d-none d-lg-block col-lg-1 "></div>
                <div class="col-lg-2 col-md-3 col-6 divPositioning wrap">
                    <ul class="verticalAlignText">
                        <li>SUSHI</li>
                    </ul>

                    <img class="centered imageTranslate imagePositioning img-fluid" src="images/popular1.jpg" />
                    <p class="homeContainer"><b>The Chinese Cafe'</b></p>

                    <span> THE CHINESE CAFE </span>
                </div>
                <div class="col-lg-2 col-md-3 col-6 divPositioning wrap">
                    <ul class="verticalAlignText">
                        <li>PASTA</li>
                    </ul>

                    <img class="centered imageTranslate imagePositioning img-fluid" src="images/popular9.jpg" />
                    <p class="homeContainer legendFont"><b>Tayto</b></p>

                    <span> TAYTO </span>
                </div>
            </div>
        </div> -->

    <br />
    <br />
    <div class="divider-1">
        <div class="line"></div>
    </div>
    <br />
    <br />

    <footer class="nb-footer footerbg">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <div class="about">
                        <br />

                        <img src="images/logo-dark.png" class="img-responsive center-block" alt="" />
                        <p>
                            SYRUP is a website to help users to search for popular restuarants and places they want
                            to visit. It provides foodies a platform to share their experience SYRUP is a website to
                            help users to search for popular restuarants and places they want to visit. It provides
                            foodies a platform to share their experience at different eatries and benefit others
                            from their views.
                        </p>

                        <br />
                        <div class="bigpixi-footer-social">
                            <ul>
                                <li class="bigpixi-footer-social__list-item">
                                    <a class="bigpixi-footer__icon-link" rel="nofollow" href="https://twitter.com/">
                                        <img class="bigpixi-footer-social__icon" alt="Twitter" title="Twitter" src="http://simpleicons.org/icons/twitter.svg" />
                                    </a>
                                </li>
                                <li class="bigpixi-footer-social__list-item">
                                    <a class="bigpixi-footer__icon-link" rel="nofollow" href="https://www.facebook.com/">
                                        <img class="bigpixi-footer-social__icon" alt="Facebook" title="Facebook" src="http://simpleicons.org/icons/facebook.svg" />
                                    </a>
                                </li>
                                <li class="bigpixi-footer-social__list-item">
                                    <a class="bigpixi-footer__icon-link" rel="nofollow" href="https://www.youtube.com/">
                                        <img class="bigpixi-footer-social__icon" alt="YouTube" title="YouTube" src="http://simpleicons.org/icons/youtube.svg" />
                                    </a>
                                </li>
                                <li class="bigpixi-footer-social__list-item">
                                    <a class="bigpixi-footer__icon-link" rel="nofollow" href="https://www.instagram.com/">
                                        <img class="bigpixi-footer-social__icon" alt="Instagram" title="Instagram" src="http://simpleicons.org/icons/instagram.svg" />
                                    </a>
                                </li>
                                <li class="bigpixi-footer-social__list-item">
                                    <a class="bigpixi-footer__icon-link" rel="nofollow" href="https://www.pinterest.com/">
                                        <img class="bigpixi-footer-social__icon" alt="Pinterest" title="Pinterest" src="http://simpleicons.org/icons/pinterest.svg" />
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6" style="margin-bottom: 5%">
                    <div class="footer-info-single">
                        <h2 class="title">Help Center</h2>
                        <ul class="list-unstyled">
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Features</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> FAQ's</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Sitemap</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Site Info</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6" style="margin-bottom: 5%">
                    <div class="footer-info-single">
                        <h2 class="title">Customer information</h2>
                        <ul class="list-unstyled">
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> About Us</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> FAQ's</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Your Items</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Contact Us</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Your blogs</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6" style="margin-bottom: 5%">
                    <div class="footer-info-single">
                        <h2 class="title">Security & privacy</h2>
                        <ul class="list-unstyled">
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Terms Of Use</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Privacy Policy</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Return / Refund Policy</a>
                            </li>
                            <li>
                                <a href="#" title=""><i class="fa fa-angle-double-right"></i> Sponser / User privacy</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6" style="margin-bottom: 15%">
                    <div class="footer-info-single">
                        <h2 class="title">Payments</h2>
                        <p>
                            All payments are to be made through online bank tranfer no easy paisa or cash on
                            delivery is accepted.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <section class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12" style="text-align:center">
                        <p>Copyright © 2018. All rights reserved for SYRUP</p>
                    </div>
                    <div class="col-sm-6"></div>
                </div>
            </div>
        </section>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/5.7.0/firebase.js"></script>
    <script src="js/app.js"></script>
    <script>
        $(document).ready(function () {
            $('#menu-link').click(function (e) {
                e.preventDefault();
                var menuToSearch = $('#restaurant-name').text();
                localStorage.setItem('menuToSearch', menuToSearch);
                window.location.href = 'Menu.html';
            });
        });
        document.getElementById('map').style.height = '500px';
        var mapBool = true;
        var map;

        function initMap() {
            // Get The Filters
            var priceArray = localStorage.getItem('priceArray').split(',');
            var categoryArray = localStorage.getItem('categoryArray').split(',');
            var from = localStorage.getItem('from').split(':');
            var to = localStorage.getItem('to').split(':');
            // Root Ref
            database = firebase.database().ref();
            filter(from, to, categoryArray, priceArray, database);
        }

        function filter(from, to, categories, prices, database) {
            console.log(from);
            console.log(to);
            console.log(categories);
            console.log(prices);
            category = categories[0];
            var filteredArray = [];
            var timeBool = false;
            if (from && to) {
                console.log('From and to Given');
                timeBool = true;
            }

            database.child('Categories/' + category).once('value', function (snapNames) {
                snapNames.forEach(function (childName) {
                    // childName loops through the list of Resturant Names Recieved under the category.
                    database.child('Restaurants/' + childName.key).once(
                        // After Category Filter
                        'value',
                        function (resSnaps) {
                            // Here I have the data of Exactly one Resturant.
                            // This loop will have specific data everytime the outer loop chnages the child name childName.
                            const restaurantData = resSnaps.val(); // extract data
                            // console.log(restaurantData);
                            if (
                                restaurantData['price'] == prices[0] ||
                                restaurantData['price'] == prices[1] ||
                                restaurantData['price'] == prices[2]
                            ) {
                                // After Price Filter
                                console.log(restaurantData);
                                if (timeBool) {
                                    // Now for Time related calculations
                                    var resFrom = restaurantData['from'].split(':');
                                    console.log(resFrom);
                                    var resTo = restaurantData['to'].split(':');
                                    console.log(resTo);

                                    // Creating Restaurant Timings
                                    var resOpeningTime = new Date(
                                        2018,
                                        11,
                                        20,
                                        parseInt(resFrom[0]),
                                        parseInt(resFrom[1])
                                    );
                                    if (parseInt(resTo[0]) < parseInt(resFrom[0])) {
                                        var resClosingTime = new Date(
                                            2018,
                                            12,
                                            20,
                                            parseInt(resTo[0]),
                                            parseInt(resTo[1])
                                        ); // If close in next day - AM
                                    } else {
                                        var resClosingTime = new Date(
                                            2018,
                                            11,
                                            20,
                                            parseInt(resTo[0]),
                                            parseInt(resTo[1])
                                        ); // if close in same day - PM
                                    }

                                    var fromTime = new Date(2018, 11, 20, parseInt(from[0]),
                                        parseInt(from[1]));
                                    if (parseInt(to[0]) < parseInt(from[0])) {
                                        var toTime = new Date(2018, 12, 20, parseInt(to[0]),
                                            parseInt(to[1])); // If close in next day - AM
                                    } else {
                                        var toTime = new Date(2018, 11, 20, parseInt(to[0]),
                                            parseInt(to[1])); // if close in same day - PM
                                    }
                                    var toTime = new Date(2018, 11, 20, parseInt(to[0]), parseInt(
                                        to[1]));
                                    var startingCheck = (fromTime - resOpeningTime) / 1000 / 60;
                                    console.log(startingCheck);
                                    var endingCheck = (resClosingTime - toTime) / 1000 / 60;
                                    console.log(endingCheck);

                                    console.log(
                                        'Opening Time: ' + resOpeningTime + ' Closing Time: ' +
                                        resClosingTime
                                    );
                                    console.log('From: ' + fromTime + ' To: ' + toTime);

                                    if (startingCheck > 0 && endingCheck > 0) {
                                        console.log(restaurantData.lat);
                                        console.log(restaurantData.lng);
                                        filteredArray.push(restaurantData);
                                        // console.log(filteredArray[0]);

                                        if (mapBool) {
                                            mapBool = false;
                                            document.getElementById('restaurant-name').innerText =
                                                resSnaps.key;
                                            document.getElementById('address').innerText =
                                                'Address: ' + restaurantData.address;
                                            document.getElementById('rating').innerText =
                                                'Overall Rating: ' + restaurantData.rating;
                                            document.getElementById('description').innerText =
                                                restaurantData.description;
                                            document.getElementById('status').innerText =
                                                'Status: ' + restaurantData.status;
                                            // document.getElementById('timings').innerHTML = restaurantData.timings;
                                            document.getElementById('phone').innerText =
                                                'Phone: ' + restaurantData.phone;
                                            document.getElementById('link').innerText =
                                                'Website: ' + restaurantData.link;
                                            var longitude = parseFloat(restaurantData.lng);
                                            var latitude = parseFloat(restaurantData.lat);
                                            console.log('lat:' + latitude + ' long: ' + longitude);
                                            var location = {
                                                lat: latitude,
                                                lng: longitude
                                            };
                                            map = new google.maps.Map(document.getElementById('map'), {
                                                center: {
                                                    lat: latitude,
                                                    lng: longitude
                                                },
                                                zoom: 15,
                                            });
                                            var marker = new google.maps.Marker({
                                                position: location,
                                                map: map
                                            });
                                            this.directionsService = new google.maps.DirectionsService();
                                            this.directionsDisplay = new google.maps.DirectionsRenderer();
                                            this.directionsDisplay.setMap(map);
                                            var start = {
                                                lat: parseFloat(localStorage.getItem(
                                                    'originLat')),
                                                lng: parseFloat(localStorage.getItem(
                                                    'originLng')),
                                            };
                                            var end = location;
                                            var request = {
                                                origin: start,
                                                destination: end,
                                                travelMode: google.maps.DirectionsTravelMode.DRIVING,
                                            };
                                            directionsService.route(request, function (response,
                                                status) {
                                                directionsDisplay.setDirections(response);
                                            });
                                        }
                                    }
                                } else {
                                    if (mapBool) {
                                        mapBool = false;
                                        var longitude = parseFloat(restaurantData.lng);
                                        var latitude = parseFloat(restaurantData.lat);
                                        console.log('lat:' + latitude + ' long: ' + longitude);
                                        var location = {
                                            lat: latitude,
                                            lng: longitude
                                        };
                                        map = new google.maps.Map(document.getElementById('map'), {
                                            center: {
                                                lat: latitude,
                                                lng: longitude
                                            },
                                            zoom: 15,
                                        });
                                        var marker = new google.maps.Marker({
                                            position: location,
                                            map: map
                                        });
                                    }
                                }
                            }
                        }
                    );
                });
            });
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBnOuekKGU_ZXety0h8_dCbvd41sdAQ9V4&callback=initMap"
        async defer></script>
</body>

</html>